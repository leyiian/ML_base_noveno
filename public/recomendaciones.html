<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recomendación de Juegos</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>Recomendación de Juegos</h1>

    <div id="cliente-info">
        <h2>Seleccionar Cliente</h2>
        <form id="cliente-form">
            <label for="cliente-id">ID del Cliente</label>
            <input type="text" id="cliente-id" name="cliente-id" required>
            <button type="submit">Consultar</button>
        </form>
        <div id="cliente-detalles"></div>
    </div>

    <div id="preferencias-form-container" style="display: none;">
        <h2>Preferencias del Cliente</h2>
        <form id="preferences-form">
            <input type="hidden" id="cliente-id-hidden">

            <!-- Selección de Plataforma -->
            <fieldset>
                <legend>Plataforma</legend>
                <label>
                    <input type="radio" name="plataforma" value="PC" required> PC
                </label><br>
                <label>
                    <input type="radio" name="plataforma" value="Xbox"> Xbox
                </label><br>
                <label>
                    <input type="radio" name="plataforma" value="PlayStation 5"> PlayStation 5
                </label><br>
                <label>
                    <input type="radio" name="plataforma" value="PlayStation 4"> PlayStation 4
                </label><br>
                <label>
                    <input type="radio" name="plataforma" value="Nintendo"> Nintendo
                </label>
            </fieldset>

            <!-- Selección de Géneros -->
            <fieldset>
                <legend>Géneros</legend>
                <label>
                    <input type="checkbox" name="generos" value="Acción"> Acción
                </label><br>
                <label>
                    <input type="checkbox" name="generos" value="Simulación"> Simulación
                </label><br>
                <label>
                    <input type="checkbox" name="generos" value="Aventura"> Aventura
                </label><br>
                <label>
                    <input type="checkbox" name="generos" value="RPG"> RPG
                </label><br>
                <label>
                    <input type="checkbox" name="generos" value="Shooter"> Shooter
                </label><br>
                <label>
                    <input type="checkbox" name="generos" value="Deportes"> Deportes
                </label><br>
                <label>
                    <input type="checkbox" name="generos" value="Estrategia"> Estrategia
                </label>
            </fieldset>

            <button type="submit">Obtener Recomendación</button>
        </form>
        <div id="recommendation"></div>
        <button id="assign-button" style="display: none;">Asignar Juego Recomendado</button>
    </div>

    <script>
        document.getElementById('cliente-form').addEventListener('submit', function (e) {
            e.preventDefault();
            const clienteId = document.getElementById('cliente-id').value;

            fetch(`/recommend/cliente/${clienteId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        document.getElementById('cliente-detalles').innerText = data.error;
                    } else {
                        const clienteDetalles = `
                            <p>Nombre: ${data.cliente.nombre_completo}</p>
                            <p>Plataforma Actual: ${data.plataformaActual}</p>
                            <p>Géneros Seleccionados: ${data.cliente.generos.join(', ')}</p>
                        `;
                        document.getElementById('cliente-detalles').innerHTML = clienteDetalles;
                        document.getElementById('cliente-id-hidden').value = data.cliente.id;
                        document.getElementById('preferencias-form-container').style.display = 'block';
                    }
                })
                .catch(error => console.error('Error:', error));
        });

        document.getElementById('preferences-form').addEventListener('submit', function (e) {
            e.preventDefault();

            // Obteniendo la plataforma seleccionada
            const plataforma = document.querySelector('input[name="plataforma"]:checked')?.value;
            if (!plataforma) {
                alert('Por favor selecciona una plataforma.');
                return;
            }

            // Obteniendo los géneros seleccionados
            const generos = Array.from(document.querySelectorAll('input[name="generos"]:checked')).map(input => input.value);

            const id = document.getElementById('cliente-id-hidden').value;

            fetch('/recommend', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ id, plataforma, generos })
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    document.getElementById('recommendation').innerText = `Error: ${data.error}`;
                } else {
                    document.getElementById('recommendation').innerText = `Juego Recomendado: ${data.recommendedGame}`;
                    const assignButton = document.getElementById('assign-button');
                    assignButton.style.display = 'block';
                    assignButton.onclick = function() {
                        fetch('/assign', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ id, juego: data.recommendedGame })
                        })
                        .then(response => response.json())
                        .then(assignData => {
                            if (assignData.error) {
                                alert(`Error: ${assignData.error}`);
                            } else {
                                alert(assignData.message);
                                document.getElementById('recommendation').innerText += ` - Juego Asignado`;
                                assignButton.style.display = 'none';
                            }
                        })
                        .catch(error => console.error('Error:', error));
                    };
                }
            })
            .catch(error => console.error('Error:', error));
        });
    </script>
</body>
</html>
