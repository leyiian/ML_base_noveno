<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Predicción de Probabilidad de Compra</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/probabilidad.css"
</head>
<body>
    <div class="container mt-5">
        <h2>Predicción de Probabilidad de Compra</h2>

        <!-- Formulario de predicción -->
        <form id="predictionForm">
            <div class="mb-3">
                <label for="nombre" class="form-label">Nombre</label>
                <select class="form-select" id="nombre" required>
                    <!-- Opciones se llenarán dinámicamente -->
                </select>
            </div>
            <div class="mb-3">
                <label for="plataforma" class="form-label">Plataforma</label>
                <select class="form-select" id="plataforma" required>
                    <!-- Opciones se llenarán dinámicamente -->
                </select>
            </div>
            <div class="mb-3">
                <label for="tipo" class="form-label">Tipo</label>
                <select class="form-select" id="tipo" required>
                    <!-- Opciones se llenarán dinámicamente -->
                </select>
            </div>
            <div class="mb-3">
                <label for="monto" class="form-label">Monto</label>
                <input type="number" class="form-control" id="monto" required>
            </div>
            <button type="submit" class="btn btn-primary">Predecir</button>
            <a href="index.html" class="btn custom-btn">Volver al inicio</a>

        </form>

        <div id="result" class="mt-4">
            <h3>Probabilidad: <span id="probabilidad">-</span></h3>
        </div>
    </div>

    <script>
        // Función para obtener las opciones del servidor y llenar los select
        async function cargarOpciones() {
            try {
                const response = await fetch('/opciones');
                const data = await response.json();

                // Llenar las opciones de los selects
                const nombreSelect = document.getElementById('nombre');
                const plataformaSelect = document.getElementById('plataforma');
                const tipoSelect = document.getElementById('tipo');

                // Llenar los select con las opciones del servidor
                data.nombres.forEach(nombre => {
                    const option = document.createElement('option');
                    option.value = nombre;
                    option.textContent = nombre;
                    nombreSelect.appendChild(option);
                });

                data.plataformas.forEach(plataforma => {
                    const option = document.createElement('option');
                    option.value = plataforma;
                    option.textContent = plataforma;
                    plataformaSelect.appendChild(option);
                });

                data.tipos.forEach(tipo => {
                    const option = document.createElement('option');
                    option.value = tipo;
                    option.textContent = tipo;
                    tipoSelect.appendChild(option);
                });
            } catch (error) {
                console.error('Error al cargar las opciones:', error);
            }
        }

        // Cargar las opciones cuando se carga la página
        window.onload = cargarOpciones;

        // Manejar el envío del formulario
        document.getElementById('predictionForm').addEventListener('submit', async function(event) {
            event.preventDefault();

            const nombre = document.getElementById('nombre').value;
            const plataforma = document.getElementById('plataforma').value;
            const tipo = document.getElementById('tipo').value;
            const monto = parseFloat(document.getElementById('monto').value);

            // Enviar los datos al servidor para hacer la predicción
            const response = await fetch('/predict', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ nombre, plataforma, tipo, monto })
            });

            const result = await response.json();
            document.getElementById('probabilidad').textContent = result.probabilidad + '%';
        });
    </script>

</body>
</html>
